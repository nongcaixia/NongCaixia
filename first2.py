import streamlit as st

st.set_page_config(page_title="电影世界", page_icon="🎬")
st.title("红楼梦第一部📺")

# 1. 视频列表（保持不变）
video_arr = [
    {
        'url': 'https://www.w3school.com.cn/example/html5/mov_bbb.mp4',
        'title': '第1集'
    },
    {
        'url': 'https://www.w3schools.com/html/movie.mp4',
        'title': '第2集'
    },
    {
        'url': 'https://media.w3.org/2010/05/sintel/trailer.mp4',
        'title': '第3集'
    },
    {
        'url': 'https://www.w3schools.com/html/movie.mp4',
        'title': '第4集'
    },
    {
        'url': 'https://media.w3.org/2010/05/sintel/trailer.mp4',
        'title': '第5集'
    }
]

# 2. 新增：集数对应的介绍列表（索引与video_arr一一对应）
episode_intro = [
    # 第1集介绍
    "空空道人路经大荒山，惊见孤石凿刻前世今生：“无才补天，幻形入世，蒙茫茫大士，渺渺真人携入红尘，历尽离合悲欢炎凉世态的传奇”。据石偈坠落之乡，追述至姑苏城里乡宦甄士隐之身世，演绎一生荣枯。更有甄士隐受神灵旨意，梦中和幻化巨石为玉的僧道相遇，验证天地之精华，投胎前生之真身，好不一般。但甄士隐虽神仙一流人品，只一事不足，年已半百，膝下只有一女，却神奇般遗失，运道败落，随了僧道西去。",
    # 第2集介绍
    "黛玉进了贾府，处处小心在意。宝黛初会，二人都认为对方是前世见过的，格外亲密。贾雨村和贾府连了宗，立刻走马上任。门子献给贾雨村一张护官符，上面列明贾史王薛四大家族。其中薛家的薛蟠打死人命，贾雨村却听了门子的话给胡乱了结了。薛蟠高高兴兴带着薛姨妈和薛宝钗上京，暂住在贾府。宁国府家宴，宝玉喝醉后睡在秦可卿房中，梦游太虚幻境，见到一位神仙姐姐。",
    # 第3集介绍
    "因无法融入宁府的气氛，宝玉到秦可卿房中午睡。梦中来到太虚幻境，既读到了家族女儿悲欢，又被“可卿”教授了云雨之欢，醒后与袭人共试。而同时黛玉也已不再生气，小风波平息。谈及“穷人攀富”，引出刘姥姥进荣国府攀亲求财。凤姐趾高气扬地在刘姥姥面前做足贵族架子，恩赐了不在乎的一点银子，却是刘姥姥的救命钱。",
    # 第4集介绍
    "薛姨妈处有精美的宫花，周瑞家的将宫花送给各人，只有黛玉不愿接受。宁府的尤氏请凤姐过去玩乐，宝玉随去，无意中遇见了秦可卿的弟弟秦钟，宝玉十分喜欢，邀他到贾府念书。宝玉想起宝钗小病，前去探望，两人拿出宝玉和金璎珞，互相比看，不料黛玉来了，打趣他们。宝玉喝醉回房，趁酒意大骂李嬷嬷。秦家恭敬的领了秦钟来贾府，等着一起读书。",
    # 第5集介绍
    "宝玉和秦钟一起上学，但是无心读书，只是眉来眼去，勾留美貌的小学生。一日，薛蟠不在，薛蟠的旧好和秦钟有意，被同学金荣所奚落，茗烟冲进学堂大骂，金荣等和宝玉的小厮们大打出手，大闹学堂。金荣的亲戚金氏来尤氏面前告状，却得知秦可卿重病缠身，不禁噤声离去。尤氏不知秦可卿究竟何病，十分好奇，贾珍派人请来张先生给秦可卿诊病。看似医术高明，贾珍等仍旧忧心。"
]

# 检查session_state中有没有ind（当前选中的集数索引）
if 'ind' not in st.session_state:
    st.session_state['ind'] = 0

# 3. 关键：在标题和视频之间显示当前集数的介绍（用st.text）
current_ind = st.session_state['ind']
st.text(f"【{video_arr[current_ind]['title']}剧情介绍】")  # 小标题（可选）
st.text(episode_intro[current_ind])  # 核心：显示对应集数的介绍

# 显示视频
st.video(video_arr[current_ind]['url'], autoplay=True)

# 切换集数的函数
def play(i):
    st.session_state['ind'] = int(i)

# 三列布局显示集数按钮
cols = st.columns(3)
for idx, i in enumerate(range(len(video_arr))):
    col_idx = idx % 3
    with cols[col_idx]:
        st.button(
            f'第{i + 1}集',
            use_container_width=True,
            on_click=play,
            args=[i]
        )

# 红楼梦整体介绍（保持不变）
st.header('关于《红楼梦》📖')
st.caption('红楼梦简介')
st.text('《红楼梦》，中国古代章回体长篇小说，中国古典四大名著之一。其通行本共120回，一般认为前80回是清代作家曹雪芹所著，后40回作者为无名氏，整理者为程伟元、高鹗。')
st.text('《红楼梦》以贾、史、王、薛四大家族的兴衰为背景，以富贵公子贾宝玉为视角，以贾宝玉与林黛玉、薛宝钗的爱情婚姻悲剧为主线，描绘了一些闺阁佳人的人生百态，展现了真正的人性美和悲剧美，是一部从各个角度展现女性美以及中国古代社会百态的史诗性著作。')
st.text('《红楼梦》版本有120回“程本”和80回“脂本”两大系统。程本为程伟元排印的印刷本，脂本为脂砚斋在不同时期抄评的早期手抄本。脂本是程本的底本。')
st.text('《红楼梦》是一部具有世界影响力的人情小说、中国封建社会的百科全书、传统文化的集大成者。其作者以“大旨谈情，实录其事”自勉，只按自己的事体情理，按迹循踪，摆脱旧套，新鲜别致，取得了非凡的艺术成就。“真事隐去，假语存焉”的特殊笔法更是令后世读者脑洞大开，揣测之说久而遂多。二十世纪以来，《红楼梦》更以其丰富深刻的思想底蕴和异常出色的艺术成就使学术界产生了以其为研究对象的专门学问——红学。')
